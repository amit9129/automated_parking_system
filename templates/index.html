<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Automated Parking System</title>
        <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            form { margin-bottom: 20px; }
            #exitResult { margin-top: 20px; }
        </style>
    </head>
<body>
    <h1>Automated Parking System</h1>

    <h2>Vehicle Entry</h2>
    <form id="entryForm">
        <button type="submit">Register Vehicle Entry</button>
    </form>

    <h2>Vehicle Exit</h2>
    <form id="exitForm">
        <label for="exitVehicleNumber">Vehicle Number:</label>
        <input type="text" id="exitVehicleNumber" required>
        <button type="submit">Process Exit</button>
    </form>
    
    <div id="exitResult"></div>

    <h2>Payment</h2>
    <form id="paymentForm">
        <label for="paymentVehicleNumber">Vehicle Number:</label>
        <input type="text" id="paymentVehicleNumber" required>
        <select id="paymentMethod">
            <option value="cash">Cash</option>
            <option value="online">Online</option>
        </select>
        <button type="submit">Pay</button>
    </form>

    <script>
        document.getElementById('entryForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const response = await fetch('/entry', { method: 'POST' });
            const result = await response.json();
            alert(result.message + (result.qr_code ? ` QR Code: ${result.qr_code}` : ''));
        });

        document.getElementById('exitForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const vehicleNumber = document.getElementById('exitVehicleNumber').value;

            const response = await fetch('/exit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ vehicle_number: vehicleNumber })
            });

            if (response.ok) {
                const result = await response.json();
                const exitResultDiv = document.getElementById('exitResult');
                exitResultDiv.innerText = `Vehicle Number: ${result.slip.vehicle_number}
                    \nEntry Time: ${result.slip.entry_time}
                    \nExit Time: ${result.slip.exit_time}
                    \nHours Parked: ${result.slip.hours_parked}
                    \nTotal Amount: ${result.slip.total_amount} INR
                    \nPayment Options: 
                    Cash: ${result.payment_options.cash}, 
                    Online: ${result.payment_options.online}`;
            } else {
                const error = await response.json();
                alert(error.message);
            }
        });

        document.getElementById('paymentForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const vehicleNumber = document.getElementById('paymentVehicleNumber').value;
            const paymentMethod = document.getElementById('paymentMethod').value;

            const response = await fetch('/pay', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ vehicle_number: vehicleNumber, payment_method: paymentMethod })
            });

            if (response.ok) {
                const result = await response.json();
                alert(result.message);
            } else {
                const error = await response.json();
                alert(error.message);
            }
        });
    </script>
</body>
</html>
